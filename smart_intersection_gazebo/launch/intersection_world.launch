<?xml version="1.0"?>

<!--derived from the ugv_course_launch audibot_road_world launch file. 

    The world created is also derived from the road_world
  
  -->

<launch>

  <param name="/use_sim_time" value="true" />

  <node pkg="ugv_course_gazebo" type="robust_gazebo_launch.py" name="gazebo_launch" output="screen">
    <param name="launch_cmd" value="$(find ugv_course_gazebo)/launch/gazebo_world.launch world_name:=$(find smart_intersection_gazebo)/worlds/figure_eight.world use_camera_control:=false" />
  </node>

  <include file="$(find audibot_lane_detection)/launch/lane_detection.launch">
    <arg name="nodelet" value="true" />
  </include>

  <group ns="audibot">
    <node pkg="pose_base_controller" type="pose_base_controller" name="pose_base_controller" output="screen">
      <remap from="base_controller/command" to="cmd_vel" />
      <remap from="pose_base_controller/goal" to="target_path" />
      <param name="fixed_frame" value="odom" />
      <param name="holonomic" value="false" />
      <param name="k_trans" value="5.0" />
      <param name="k_rot" value="5.0" />
      <param name="max_vel_lin" value="0.3" />
      <param name="max_vel_th" value="1.4" />
      <param name="tolerance_trans" value="0.05" />
      <param name="tolerance_rot" value="0.04" />
    </node>
    <!-- <node pkg="pose_follower_ackermann" type="pose_follower_ackermann_node" name="pose_follower_ackermann" output="screen" /> -->
    <node pkg="audibot_twist_controller" type="audibot_twist_node" name="twist_control" output="screen" />
  </group>

  <node name="speed_reconfig" pkg="dynamic_reconfigure" type="dynparam" args="set_from_parameters /audibot/path_following">
    <param name="speed" type="double" value="15.0" />
  </node>

  <node name="feedback_reconfig" pkg="dynamic_reconfigure" type="dynparam" args="set_from_parameters /audibot/twist_control/steering">
    <param name="feedback_gain" type="double" value="100.0" />
  </node>


</launch>
